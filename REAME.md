# Firmware info
- Device name: **N200RE V5**
- Build version: **V9.3.5u.6437_B20230519** 
- Download link: https://www.totolink.net/home/menu/detail/menu_listtpl/download/id/204/ids/36.html
- Authentication: Yes (Login as account on firmware's web interface)
- Affect: Unknown number of ToTotlink firmware that uses function `Validity_check`.

# Description and Impact
Totolink is using function `Validity_check` to fix OS command injection vulnerability. An attacker can bypass this filter using character `%`, exploit the format string at `snprintf` function to execute OS system commands.

# Root-casue
Function `Validity_check` finds blacklisted strings / characters such as ```$ ` | ; &```
![image](https://private-user-images.githubusercontent.com/146601047/373981762-601c3f74-a87e-4455-864a-c31af47f0442.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzYyLTYwMWMzZjc0LWE4N2UtNDQ1NS04NjRhLWMzMWFmNDdmMDQ0Mi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1iNTk3NjM2YTAwZDY3YjgxMThiNDAzMzRmNTFkOWFkYzY5ODg2MTdlMjZmYjRjZDJiYmYyNjhkNmU4NjNiYTBjJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.C2sLOaRdC-2qyCGSFyWZfbj2yPzkNTgbQ1LnBf67gdU)

After the validation, the server executes system command when it can't find any blacklisted characters
![image](https://private-user-images.githubusercontent.com/146601047/373981763-f24f1547-280e-4954-b225-fcf60601bad2.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzYzLWYyNGYxNTQ3LTI4MGUtNDk1NC1iMjI1LWZjZjYwNjAxYmFkMi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1mMjg5ZTQxY2Y3ZjMyZGIwYTJmYjQxZTVmYjQzN2EwOGM5YWRhM2Y1NmRlMDI4OGY2OWZjNTVlNTQxMjg2ZTk5JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.9cj3DNMRDFKvabRp4dukSDVcgXPI8txMv0OayDE-1ts)

The program is calling some external libraries

![image](https://private-user-images.githubusercontent.com/146601047/373981764-abbdabca-a54d-4a38-a3d3-498d275e7e7f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzY0LWFiYmRhYmNhLWE1NGQtNGEzOC1hM2QzLTQ5OGQyNzVlN2U3Zi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT03NWJhNjYzZWIxNDY1ZTdjYmUzZTgxYzljNTU1NzBiYjVjNWFiODVmNzYyNWJjMTRjYmE0MWY0MjNlNzJmNjI2JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.ZwszBAltHAZOkqoFUK5ebLSf7TtRxB9OVUq-Bje1A_Q)

Function `doSystem` is using function `vsnprintf` to craft system command and then execute using `system`.

![image](https://private-user-images.githubusercontent.com/146601047/373981765-3d1ac053-1573-4949-9e2f-c91ab2982938.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzY1LTNkMWFjMDUzLTE1NzMtNDk0OS05ZTJmLWM5MWFiMjk4MjkzOC5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0zZjM0N2RiM2I0MzU3YmI2MzM3YTMzZjc5OTI0MGU3MzExYmI4YWFhMmFiMTlmMTA5OWZhYTk5MDQ0ZGM3NWZlJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.EIzXr3vVq5Orq_DAatSe5pD9C08xDqjoZ_a5zAVAHDo)

Functions`snprintf` and `vsnprintf` are vulnerable against format string attack (source: Format string attack | OWASP)
![image](https://private-user-images.githubusercontent.com/146601047/373981767-02e01fb2-abe2-446f-9156-7f6e3b0a8220.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzY3LTAyZTAxZmIyLWFiZTItNDQ2Zi05MTU2LTdmNmUzYjBhODIyMC5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0xYzk5NmQ0MTJjNGZjY2MzMmUyMGFhMmE5OGMzZGFiYzIyZjRmZjk2Mjk2MzZiMzcyZjEzYmRkZTI3NmM4Y2E3JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.1hf4GrssF-a7uRzyWTe_mYWdXa3qvXHYLuPlSU5bhfc)


# Steps to reprocedure
when use the `ping` or `traceroute` feature, attacker can inject character `%x` in the IP address
![image](https://private-user-images.githubusercontent.com/146601047/373981768-631a7371-f6ae-4a7a-a057-6bdd667823bb.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzY4LTYzMWE3MzcxLWY2YWUtNGE3YS1hMDU3LTZiZGQ2Njc4MjNiYi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1lZTJmMWM0ZTQ5YzczYTZlMDViODcyNTBiZTAzODI5NzE0NjM4ZTc2Nzc2NjFkNDgyMWMxMGYzNDE1OGM1NWQ4JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.3EaKx1NaN9zUOP9dGFKEichi7t3B4npWVUH8hVjL3yE)

The server responses with a hex value, suggesting it could be a format string vulnerability
![image](https://private-user-images.githubusercontent.com/146601047/373981769-3aacf8f2-820f-4201-9b7a-3ee070237608.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzY5LTNhYWNmOGYyLTgyMGYtNDIwMS05YjdhLTNlZTA3MDIzNzYwOC5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT02YmM3ZjJmOTIzMjA5NWE4NzIwNTA2YThhNTg2MTc4NzdkMGJhOTE0YjMxOWQ0ZmU4NzBlZmY1NzJmZjk5NmQ1JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.aL0g5XxHZhHOPhdjZTdwPqVhIBhnT0_0_KQU5IREB_U)

When attacker uses payload `%whoami`, the server response busybox's output. It suggests that the string `whoami` was delivered to the `busybox` interpreter
![image](https://private-user-images.githubusercontent.com/146601047/373981771-ccb480d5-aac1-4b1f-8d29-b2c051c6c09e.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzcxLWNjYjQ4MGQ1LWFhYzEtNGIxZi04ZDI5LWIyYzA1MWM2YzA5ZS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1lYWE2MDMxMmMyMmE2MDVkZTdkODQyMTk1NDgyNTQ4OTNiZTA0NGFmYjhlZjBhMmIzYTg0MTExYjMyYjVlODM4JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.cPZCem75FNudXUSel38uxvrKnL8GmtQ0Q59zYOtLg9E)
![image](https://private-user-images.githubusercontent.com/146601047/373981774-a11b8539-fce2-4643-b08f-e6ba475f913a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzc0LWExMWI4NTM5LWZjZTItNDY0My1iMDhmLWU2YmE0NzVmOTEzYS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0yZjQwYzhhMDkwMDFiMmJiYzVjYWI3ZGM0MDNhZDcyY2ZmNzE2YTAxZTRkOWIwMzE3MjgxY2I5ZjU2ZGI1NDk3JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.tpBLnMsispct_LF6WZPjgRmkIgDnf-gRjE2sAsj9_Ek)

When attacker sent the same payload to `traceroute`, the command was executed sucessfully
![image](https://private-user-images.githubusercontent.com/146601047/373981775-11462ef4-e4ea-4184-a04d-2dfb28f42721.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzc1LTExNDYyZWY0LWU0ZWEtNDE4NC1hMDRkLTJkZmIyOGY0MjcyMS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT03MjhkMmI3Y2M1M2Q5MDdmNmMwMWMzYjc0ZTM2NDFmZmJjMDY5YWNlMzZiODc1NTFmOGFhNDY4NjRjYzgxOTUzJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.gtwxoRhyVz41kpShWiC6SL4C2K683uF54kiQs5FqKEY)
![image](https://private-user-images.githubusercontent.com/146601047/373981776-83d1247b-f2c3-49ab-80e1-0156f8810cf9.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzc2LTgzZDEyNDdiLWYyYzMtNDlhYi04MGUxLTAxNTZmODgxMGNmOS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0xMDM3OGY2ZWRkZWVkYWM0ZTNlN2M5MzIyNTBmMWZhZjNhNjZiY2QxOGU0ODZhNjcyZWUwYjNmZTcyNWExNjljJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.7p8AAwPZhQ4tU2YqZkZdm_wNn8KycvC3M7nwmTXSSa0)

Due to limitation of the `%` as the string format, some command can't be executed. The reason is the first character
![image](https://private-user-images.githubusercontent.com/146601047/373981778-422b6007-5375-4613-9fc9-6bb90bd077f2.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzc4LTQyMmI2MDA3LTUzNzUtNDYxMy05ZmM5LTZiYjkwYmQwNzdmMi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1kNTJhM2Q2ODkyNzlhMWVlMGJlZmE5NjNlMDhmZmE4MzJlNWIyYTEyY2U4ZmY1YTdmZGFlMDM3NDViOWU3NmIwJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.TDLf0_2cykbrA5r6nri2Ot8RIAL1Rq38C4gCiXkrBJA)
![image](https://private-user-images.githubusercontent.com/146601047/373981780-9b2935c6-9950-42f3-9a3e-17de99ec2029.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzgwLTliMjkzNWM2LTk5NTAtNDJmMy05YTNlLTE3ZGU5OWVjMjAyOS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1jYThmNGUxNmI4N2U4M2IyN2NjNTZjOWU1MWRiMjQ0MGQyMGVhZWIyMzFiMmI3NjYyYTRjYjU2MGQ5Mzk0ZTczJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.5YMVDVOIIX-NOtBp39IHI_3W8jJ428-4I-slgiiyURY)

Attacker can use absolute path to bypass this issue, executing system command
![image](https://private-user-images.githubusercontent.com/146601047/373981781-ea2d8849-e02e-4314-ab60-ad7872942ff4.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzgxLWVhMmQ4ODQ5LWUwMmUtNDMxNC1hYjYwLWFkNzg3Mjk0MmZmNC5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1kY2VlMmYxMWFhODIxNDQ5YzQ1OWI2OTM3NTliOTRiOWY2ZmYzMGVmMGYzZjdlMmI0NmViZWQ3YzgwMTE1ZDgwJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.tcf-nZfnwMMNHFQ3XYxh_J2oykNa9uUud0VvJbxue3E)
![image](https://private-user-images.githubusercontent.com/146601047/373981783-05484041-f704-4d3f-b68e-d609b26feaa5.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzgzLTA1NDg0MDQxLWY3MDQtNGQzZi1iNjhlLWQ2MDliMjZmZWFhNS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0xZTNkMmRjYTM1Y2RhNzI2NjdmMWYxNzBjMGE5MjdlZjRmNGRiNWMyZjliYTAwZmRlZGQ4OGE0MDhjMWQwY2YxJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9._l-wiDScZhLQLOwm61LAXlf6yKGs7Av9c_RamtG5Je0)

When attacker uses ping feature to exploit, it might be command failed to run because the flag `-w` for command `ping` is hard-coded.
![image](https://private-user-images.githubusercontent.com/146601047/373981785-0ee01ec5-a51e-4628-a3f7-a13414c0f1af.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzg1LTBlZTAxZWM1LWE1MWUtNDYyOC1hM2Y3LWExMzQxNGMwZjFhZi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1iY2JiYzNhYjIxNTZjNTk3NThhZmZlNjViOGU4Y2FjYWJmOWRkYWIzMGI1YjA4ZjBiNWY1NWNjNTliYmE3YTlhJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.5c_v5B0Mu5HIH-JZloTZ_gUFzJDX29BKGrF-65vVSOM)
![image](https://private-user-images.githubusercontent.com/146601047/373981788-f512da99-d6ed-42d1-93fe-42e3e88567cd.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzg4LWY1MTJkYTk5LWQ2ZWQtNDJkMS05M2ZlLTQyZTNlODg1NjdjZC5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0xZWQxOTAyMDllOTZmNTE1ODFiOGY4OWU0YzE1MDE3Y2YzYmFmNDI0MTJhYzA2MTAzODNkODQ0M2Y2YTg0ZGZjJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.PM47l-LexYEkul-iVXTyjfJTliWatbyORvRSqbt0kb8)

Attacker can use the syntax that calls `/bin/bash` or `/bin/sh` to execute the command that does not contain `-w`, therefore avoid the command execution error
![image](https://private-user-images.githubusercontent.com/146601047/373981789-0c9f4536-9f73-4f14-9ace-399609c13417.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzg5LTBjOWY0NTM2LTlmNzMtNGYxNC05YWNlLTM5OTYwOWMxMzQxNy5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT03NmU2YzYyYTU0NzM2MmE1ZDIwZDIwNTE1NDZmMDY3MDYzYTcxYThmOWZjMDI0NTlmZTZlNzEyMzBkYTBmOGYzJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.kkecxgxKz42dWUP5Mj8y5J_BUTzsoFPUL4OsEBLkOZs)
![image](https://private-user-images.githubusercontent.com/146601047/373981790-f59e93d4-1737-47f0-86a6-03c93d6894e1.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjgyNTEwODcsIm5iZiI6MTcyODI1MDc4NywicGF0aCI6Ii8xNDY2MDEwNDcvMzczOTgxNzkwLWY1OWU5M2Q0LTE3MzctNDdmMC04NmE2LTAzYzkzZDY4OTRlMS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQxMDA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MTAwNlQyMTM5NDdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1hYTJiN2FhOGMzZWUzYjY2YzQ1MDM4ZWMyMDI1OGRlM2VlY2U5MjYwMTU3MGUzMmE2ODUwMWUxYTUwNTk3NGU0JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.VuGx3OKri-67aQcDTs4Z54jeg5uiRihhIxqCfe61ugw)

# Recommends
- Add `%` to blacklist
- Check the logic of `doSystem` to avoid format string error.

# Reference
- https://owasp.org/www-community/attacks/Format_string_attack
- https://www.cs.cornell.edu/courses/cs3410/2008fa/MIPS_Vol2.pdf
- https://en.wikibooks.org/wiki/MIPS_Assembly/Register_File

